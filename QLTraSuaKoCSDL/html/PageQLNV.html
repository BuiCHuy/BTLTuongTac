<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý nhân viên - FiveH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.5s ease-out; }
        .animate-slide-up { animation: slide-up 0.3s ease-out; }
        .peer-sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
        input[type="radio"]:checked + .radio-dot { background-color: #7C3AED; border-color: #7C3AED; }
        input[type="radio"]:focus + .radio-dot { outline: 2px solid #C084FC; outline-offset: 2px; }
        .radio-dot { width: 1.25rem; height: 1.25rem; border-radius: 9999px; border: 2px solid #D1D5DB; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .radio-dot-inner { width: 0.375rem; height: 0.375rem; background-color: white; border-radius: 9999px; }
        .modal-content { max-height: 90vh; overflow-y: auto; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">
<!-- Header -->
<header class="flex items-center justify-between px-6 py-4 bg-white shadow-sm">
    <h1 class="text-3xl font-bold text-indigo-600">FiveH</h1>
    <div class="flex items-center space-x-6">
        <div class="flex items-center space-x-2 cursor-pointer hover:text-indigo-600 transition-colors">
            <i class="fas fa-cog text-gray-600 text-lg"></i>
            <span class="text-gray-700 font-medium">Cài đặt</span>
        </div>
        <div class="flex items-center space-x-3">
            <img src="https://placehold.co/40x40" alt="Profile" class="w-10 h-10 rounded-full border border-gray-300">
            <div class="flex flex-col">
                <span class="text-gray-700 font-medium">Quản lý</span>
                <span class="text-gray-500 text-sm cursor-pointer hover:text-indigo-600">Đăng xuất</span>
            </div>
        </div>
    </div>
</header>

<!-- Navigation -->
<nav class="bg-gradient-to-r from-purple-600 to-rose-500 py-4 px-6 shadow-md">
    <div class="max-w-7xl mx-auto flex justify-between items-center text-white">
        <a href="Trangchu.html" class="flex items-center space-x-2 cursor-pointer hover:text-gray-200 transition-colors">
            <i class="fas fa-home text-lg"></i><span class="text-lg font-semibold">Trang chủ</span>
        </a>
        <a href="PageQLBH.html" class="flex items-center space-x-2 cursor-pointer hover:text-gray-200 transition-colors">
            <i class="fas fa-shopping-cart text-lg"></i><span class="text-lg font-semibold">Bán hàng</span>
        </a>
        <a href="PageQLNV.html" class="flex items-center space-x-2 cursor-pointer hover:text-gray-200 transition-colors text-pink-100">
            <i class="fas fa-users text-lg"></i><span class="text-lg font-semibold">Nhân viên</span>
        </a>
        <a href="PageQLMH.html" class="flex items-center space-x-2 cursor-pointer hover:text-gray-200 transition-colors">
            <i class="fas fa-box text-lg"></i><span class="text-lg font-semibold">Mặt hàng</span>
        </a>
        <a href="PageQLCTKM.html" class="flex items-center space-x-2 cursor-pointer hover:text-gray-200 transition-colors">
            <i class="fas fa-tags text-lg"></i><span class="text-lg font-semibold">CT Khuyến mại</span>
        </a>
        <a href="PageQLDT.html" class="flex items-center space-x-2 cursor-pointer hover:text-gray-200 transition-colors">
            <i class="fas fa-chart-line text-lg"></i><span class="text-lg font-semibold">Doanh thu</span>
        </a>
    </div>
</nav>

<!-- Main Content -->
<main class="max-w-7xl mx-auto mt-8 px-6 animate-fade-in">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">QUẢN LÝ NHÂN VIÊN</h2>

    <!-- Search and Add Section -->
    <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-4">
            <div class="relative">
                <input
                        type="text"
                        id="searchInput"
                        placeholder="Tìm kiếm theo tên, theo mã"
                        class="h-10 w-96 px-4 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-600"
                />
                <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
            <button
                    id="searchBtn"
                    class="h-10 bg-purple-600 text-white px-4 py-2 rounded-md shadow-md hover:bg-purple-700 transition-colors flex items-center space-x-2"
            >
                <i class="fas fa-search"></i>
            </button>
        </div>
        <div class="flex space-x-4">
            <button
                    id="addNewBtn"
                    class="h-10 bg-purple-600 text-white px-4 py-2 rounded-md shadow-md hover:bg-purple-700 transition-colors flex items-center space-x-2"
            >
                <i class="fas fa-plus"></i>
                <span>Thêm mới</span>
            </button>
        </div>
    </div>

    <!-- Employee Table -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                <tr class="bg-purple-200 h-12">
                    <th class="px-4 py-2 text-left text-lg font-semibold text-gray-800">Mã NV</th>
                    <th class="px-4 py-2 text-left text-lg font-semibold text-gray-800">Tên nhân viên</th>
                    <th class="px-4 py-2 text-left text-lg font-semibold text-gray-800">Ca làm việc</th>
                    <th class="px-4 py-2 text-left text-lg font-semibold text-gray-800">Vai trò</th>
                    <th class="px-4 py-2 text-left text-lg font-semibold text-gray-800">Chi nhánh</th>
                    <th class="px-4 py-2 text-left text-lg font-semibold text-gray-800">Trạng thái</th>
                    <th class="px-4 py-2 text-left text-lg font-semibold text-gray-800">Hành động</th>
                </tr>
                </thead>
                <tbody id="employeeTableBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="flex items-center justify-end mt-4 text-sm text-gray-700 p-4 rounded">
        <button id="prevPage" class="px-3 py-1 rounded bg-gray-100 hover:bg-gray-200 disabled:opacity-50 flex items-center gap-1 transition-colors" disabled>
            <i class="fas fa-chevron-left"></i> Trước
        </button>
        <div id="pageButtons" class="flex space-x-2"></div>
        <button id="nextPage" class="px-3 py-1 rounded bg-gray-100 hover:bg-gray-200 disabled:opacity-50 flex items-center gap-1 transition-colors">
            Sau <i class="fas fa-chevron-right"></i>
        </button>
    </div>
</main>

<!-- Modals -->
<div id="modalContainer"></div>

<script>
    let employees = JSON.parse(localStorage.getItem('employees')) || [
        { id: "001", name: "Nguyễn Văn An", shift: "Sáng", role: "Nhân viên pha chế", branch: "Tây Sơn", status: "Đang hoạt động", statusType: "active", phone: "0123456789", email: "vanan@gmail.com", gender: "Nam", birthDate: "2000-01-01", image: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-MGWA4DVGT9c4D20xzNyiCXDhrZW2M3.png" },
        { id: "002", name: "Trần Thị Bình", shift: "Chiều", role: "Nhân viên thu ngân", branch: "Tây Sơn", status: "Không hoạt động", statusType: "inactive", phone: "0123456789", email: "thibinh@gmail.com", gender: "Nữ", birthDate: "2000-01-01", image: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-MGWA4DVGT9c4D20xzNyiCXDhrZW2M3.png" },
        { id: "003", name: "Lê Văn Cấc", shift: "Sáng", role: "Nhân viên thu ngân", branch: "Phạm Ngọc Thạch", status: "Đang hoạt động", statusType: "active", phone: "0123456789", email: "vancac@gmail.com", gender: "Nam", birthDate: "2000-01-01", image: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-MGWA4DVGT9c4D20xzNyiCXDhrZW2M3.png" },
        { id: "004", name: "Phạm Thị Dung", shift: "Tối", role: "Nhân viên pha chế", branch: "Quang Trung", status: "Không hoạt động", statusType: "inactive", phone: "0123456789", email: "thidung@gmail.com", gender: "Nữ", birthDate: "2000-01-01", image: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-MGWA4DVGT9c4D20xzNyiCXDhrZW2M3.png" },
        { id: "005", name: "Dương Văn Giáp", shift: "Chiều", role: "Nhân viên pha chế", branch: "Khương Thượng", status: "Không hoạt động", statusType: "inactive", phone: "0123456789", email: "vangiap@gmail.com", gender: "Nam", birthDate: "2000-01-01", image: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-MGWA4DVGT9c4D20xzNyiCXDhrZW2M3.png" }
    ];
    let currentPage = 1;
    const itemsPerPage = 5;
    let selectedEmployee = null;
    let isEditMode = false;
    let activeModal = null;
    let pendingEmployeeData = null;

    // Lưu nhân viên vào Local Storage khi khởi tạo
    if (!localStorage.getItem('employees')) {
        localStorage.setItem('employees', JSON.stringify(employees));
    }

    // Modal templates
    const modalTemplates = {
        add: (isEdit, data = {}) => `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div class="w-full max-w-5xl max-h-[90vh] bg-gray-50 rounded-lg shadow-2xl flex flex-col animate-slide-up overflow-y-auto modal-content">
                    <header class="flex items-center justify-between p-5 border-b-4 border-black rounded-t-lg">
                        <h2 class="text-xl font-bold text-black">${isEdit ? 'Sửa nhân viên' : 'Thêm nhân viên mới'}</h2>
                        <button onclick="closeModal()" class="w-6 h-6 flex items-center justify-center hover:bg-gray-200 rounded">
                            <i class="fas fa-times text-black"></i>
                        </button>
                    </header>
                    <div class="p-8 space-y-8">
                        <fieldset class="space-y-6">
                            <legend class="text-lg font-semibold text-purple-700">Thông tin cá nhân</legend>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="employeeId" class="block text-base font-medium text-black mb-1">Mã nhân viên</label>
                                    <input type="text" id="employeeId" value="${data.id || ''}" placeholder="Nhập mã nhân viên" class="w-full h-10 px-4 bg-gray-50 rounded-md shadow-md border border-neutral-400 focus:ring-2 focus:ring-purple-600" ${isEdit ? 'readonly' : ''}>
                                    <p id="employeeIdError" class="text-red-600 text-sm mt-1 hidden"></p>
                                </div>
                                <div>
                                    <label class="block text-base font-medium text-black mb-1">Giới tính</label>
                                    <div class="flex items-center space-x-6 h-10">
                                        <label class="flex items-center space-x-3 cursor-pointer">
                                            <input type="radio" name="gender" value="Nam" ${data.gender === 'Nam' || !isEdit ? 'checked' : ''} class="peer-sr-only">
                                            <div class="radio-dot"><div class="radio-dot-inner"></div></div>
                                            <span class="text-gray-800">Nam</span>
                                        </label>
                                        <label class="flex items-center space-x-3 cursor-pointer">
                                            <input type="radio" name="gender" value="Nữ" ${data.gender === 'Nữ' ? 'checked' : ''} class="peer-sr-only">
                                            <div class="radio-dot"><div class="radio-dot-inner"></div></div>
                                            <span class="text-gray-800">Nữ</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label for="name" class="block text-base font-medium text-black mb-1">Tên nhân viên</label>
                                    <input type="text" id="name" value="${data.name || ''}" placeholder="Nhập tên nhân viên" class="w-full h-10 px-4 bg-gray-50 rounded-md shadow-md border border-neutral-400 focus:ring-2 focus:ring-purple-600">
                                    <p id="nameError" class="text-red-600 text-sm mt-1 hidden"></p>
                                </div>
                                <div>
                                    <label for="birthDate" class="block text-base font-medium text-black mb-1">Ngày sinh</label>
                                    <input type="date" id="birthDate" value="${data.birthDate || '2000-01-01'}" class="w-full h-10 px-4 bg-gray-50 rounded-md shadow-md border border-neutral-400 focus:ring-2 focus:ring-purple-600">
                                </div>
                                <div>
                                    <label for="phone" class="block text-base font-medium text-black mb-1">Số điện thoại</label>
                                    <input type="text" id="phone" value="${data.phone || ''}" placeholder="0123456789" class="w-full h-10 px-4 bg-gray-50 rounded-md shadow-md border border-neutral-400 focus:ring-2 focus:ring-purple-600">
                                    <p id="phoneError" class="text-red-600 text-sm mt-1 hidden"></p>
                                </div>
                                <div>
                                    <label for="email" class="block text-base font-medium text-black mb-1">Email</label>
                                    <input type="email" id="email" value="${data.email || ''}" placeholder="example@email.com" class="w-full h-10 px-4 bg-gray-50 rounded-md shadow-md border border-neutral-400 focus:ring-2 focus:ring-purple-600">
                                    <p id="emailError" class="text-red-600 text-sm mt-1 hidden"></p>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset class="space-y-6">
                            <legend class="text-lg font-semibold text-purple-700">Thông tin công việc</legend>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="position" class="block text-base font-medium text-black mb-1">Chức vụ</label>
                                    <input type="text" id="position" value="${data.role || ''}" placeholder="Nhân viên pha chế" class="w-full h-10 px-4 bg-gray-50 rounded-md shadow-md border border-neutral-400 focus:ring-2 focus:ring-purple-600">
                                    <p id="positionError" class="text-red-600 text-sm mt-1 hidden"></p>
                                </div>
                                <div>
                                    <label for="branch" class="block text-base font-medium text-black mb-1">Chi nhánh</label>
                                    <select id="branch" class="w-full h-10 px-3 bg-gray-50 rounded-md shadow-md border border-neutral-400 focus:ring-2 focus:ring-purple-600">
                                        <option value="">Chọn chi nhánh</option>
                                        <option value="Tây Sơn" ${data.branch === 'Tây Sơn' ? 'selected' : ''}>Tây Sơn</option>
                                        <option value="Phạm Ngọc Thạch" ${data.branch === 'Phạm Ngọc Thạch' ? 'selected' : ''}>Phạm Ngọc Thạch</option>
                                        <option value="Quang Trung" ${data.branch === 'Quang Trung' ? 'selected' : ''}>Quang Trung</option>
                                        <option value="Khương Thượng" ${data.branch === 'Khương Thượng' ? 'selected' : ''}>Khương Thượng</option>
                                    </select>
                                    <p id="branchError" class="text-red-600 text-sm mt-1 hidden"></p>
                                </div>
                                <div>
                                    <label for="shift" class="block text-base font-medium text-black mb-1">Ca làm việc</label>
                                    <select id="shift" class="w-full h-10 px-3 bg-gray-50 rounded-md shadow-md border border-neutral-400 focus:ring-2 focus:ring-purple-600">
                                        <option value="Sáng" ${data.shift === 'Sáng' ? 'selected' : ''}>Sáng</option>
                                        <option value="Chiều" ${data.shift === 'Chiều' ? 'selected' : ''}>Chiều</option>
                                        <option value="Tối" ${data.shift === 'Tối' ? 'selected' : ''}>Tối</option>
                                    </select>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset class="space-y-6">
                            <legend class="text-lg font-semibold text-purple-700">Ảnh nhân viên</legend>
                            <div class="flex items-start gap-4">
                                <div id="imagePreview" class="w-28 h-36 bg-gray-50 rounded-xl flex items-center justify-center overflow-hidden">
                                    ${data.image ? `<img src="${data.image}" alt="Preview" class="w-full h-full object-cover" />` : `<i class="fas fa-image text-4xl text-gray-400"></i>`}
                                </div>
                                <label class="cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-purple-100 rounded-md shadow-md border border-gray-200 hover:bg-purple-200 transition-colors">
                                    <i class="fas fa-plus text-gray-600"></i>
                                    <span class="text-black text-base font-semibold">Thêm ảnh</span>
                                    <input type="file" id="imageUpload" accept="image/*" class="hidden" />
                                </label>
                            </div>
                        </fieldset>
                    </div>
                    <footer class="flex justify-end items-center p-5 space-x-4 border-t border-gray-200 bg-gray-100 rounded-b-lg mt-auto">
                        <button onclick="handleSave()" class="px-6 py-2 bg-green-600 hover:bg-purple-700 text-white rounded-md shadow-md transition-colors inline-flex items-center gap-2">
                            <i class="fas fa-save"></i><span>Lưu</span>
                        </button>
                        <button onclick="closeModal()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-black rounded-md shadow-md transition-colors font-semibold">Thoát</button>
                    </footer>
                </div>
            </div>
        `,
        search: (results) => `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div class="bg-gray-50 rounded-lg shadow-2xl border border-black p-6 w-full max-w-3xl animate-slide-up">
                    <div class="flex justify-between items-center border-b-4 border-black pb-4 mb-4">
                        <h2 class="text-xl font-bold text-black">Kết quả tìm kiếm</h2>
                        <button onclick="closeModal()" class="w-6 h-6 flex items-center justify-center hover:bg-gray-200 rounded">
                            <i class="fas fa-times text-black"></i>
                        </button>
                    </div>
                    <p class="text-black mb-4">Nhấn vào để xem thông tin chi tiết</p>
                    <div class="overflow-y-auto max-h-[60vh]">
                        ${results.length > 0 ? `
                            <table class="w-full table-fixed">
                                <thead>
                                    <tr class="bg-purple-200 text-left">
                                        <th class="px-4 py-2 font-semibold text-gray-800">Mã NV</th>
                                        <th class="px-4 py-2 font-semibold text-gray-800">Tên nhân viên</th>
                                        <th class="px-4 py-2 font-semibold text-gray-800">Ca làm việc</th>
                                        <th class="px-4 py-2 font-semibold text-gray-800">Vai trò</th>
                                        <th class="px-4 py-2 font-semibold text-gray-800">Chi nhánh</th>
                                        <th class="px-4 py-2 font-semibold text-gray-800">Trạng thái</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${results.map(e => `
                                        <tr class="hover:bg-gray-100 cursor-pointer" onclick='openModal("edit", ${JSON.stringify(e)})'>
                                            <td class="px-4 py-2 text-gray-700">${e.id}</td>
                                            <td class="px-4 py-2 text-gray-700">${e.name}</td>
                                            <td class="px-4 py-2 text-gray-700">${e.shift}</td>
                                            <td class="px-4 py-2 text-gray-700">${e.role}</td>
                                            <td class="px-4 py-2 text-gray-700">${e.branch}</td>
                                            <td class="px-4 py-2 text-gray-700">${e.status}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        ` : `
                            <p class="text-center text-gray-700">Không có kết quả nào.</p>
                        `}
                    </div>
                    <div class="flex justify-end mt-6">
                        <button onclick="closeModal()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-black rounded-md shadow-md transition-colors font-semibold">Thoát</button>
                    </div>
                </div>
            </div>
        `,
        deleteConfirm: (name) => `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div class="bg-gray-50 rounded-lg shadow-2xl border border-black p-8 max-w-sm w-full text-center animate-slide-up">
                    <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-black mb-2">Bạn có chắc chắn muốn xóa không?</h2>
                    <p class="text-base text-black mb-4">Sau khi xóa, "<span class="font-semibold">${name}</span>" sẽ không thể khôi phục lại.</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="handleConfirmDelete()" class="flex-1 px-4 py-2 bg-black hover:bg-black text-white rounded-md shadow-md transition-colors font-semibold">Có</button>
                        <button onclick="closeModal()" class="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-black rounded-md shadow-md transition-colors font-semibold">Không</button>
                    </div>
                </div>
            </div>
        `,
        deleteSuccess: `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div class="bg-gray-50 rounded-lg shadow-2xl border border-black p-8 max-w-sm w-full text-center animate-slide-up">
                    <div class="w-12 h-12 rounded-full border-4 border-purple-600 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-700 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-black mb-2">Xóa thành công</h2>
                    <p class="text-base text-black mb-6">Thông tin nhân viên đã được xóa bỏ.</p>
                    <button onclick="closeModal()" class="w-32 px-4 py-2 bg-gray-200 rounded-md shadow-md hover:bg-gray-300 transition-colors">
                        <span class="text-black font-semibold">Thoát</span>
                    </button>
                </div>
            </div>
        `,
        editConfirm: `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div class="bg-gray-50 rounded-lg shadow-2xl border border-black p-8 max-w-sm w-full text-center animate-slide-up">
                    <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-black mb-2">Bạn có chắc chắn muốn sửa không?</h2>
                    <p class="text-base text-black mb-4">Thông tin nhân viên sẽ được cập nhật vĩnh viễn.</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="handleConfirmEdit()" class="flex-1 px-4 py-2 bg-black hover:bg-gray-700 text-white rounded-md shadow-md transition-colors font-semibold">Có</button>
                        <button onclick="closeModal()" class="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-black rounded-md shadow-md transition-colors font-semibold">Không</button>
                    </div>
                </div>
            </div>
        `,
        saveSuccess: `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div class="bg-gray-50 rounded-lg shadow-2xl border border-black p-8 max-w-sm w-full text-center animate-slide-up">
                    <div class="w-12 h-12 rounded-full border-4 border-green-700 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-700 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-black mb-2">${isEditMode ? 'Sửa thành công' : 'Thêm thành công'}</h2>
                    <p class="text-base text-black mb-6">Thông tin nhân viên đã được cập nhật.</p>
                    <button onclick="closeModal()" class="w-32 px-4 py-2 bg-gray-200 rounded-md shadow-md hover:bg-gray-300 transition-colors">
                        <span class="text-black font-semibold">Thoát</span>
                    </button>
                </div>
            </div>
        `,
        editSuccess: `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div class="bg-gray-50 rounded-lg shadow-2xl border border-black p-8 max-w-sm w-full text-center animate-slide-up">
                    <div class="w-12 h-12 rounded-full border-4 border-green-700 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-700 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-black mb-2">Sửa thành công </h2>
                    <p class="text-base text-black mb-6">Thông tin nhân viên đã được cập nhật.</p>
                    <button onclick="closeModal()" class="w-32 px-4 py-2 bg-gray-200 rounded-md shadow-md hover:bg-gray-300 transition-colors">
                        <span class="text-black font-semibold">Thoát</span>
                    </button>
                </div>
            </div>
        `,
        details: (employee) => `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div class="bg-gray-50 rounded-lg shadow-2xl border border-black p-6 w-full max-w-2xl animate-slide-up">
                    <div class="flex justify-between items-center border-b-4 border-black pb-4 mb-4">
                        <h2 class="text-xl font-bold text-black">Thông tin nhân viên</h2>
                        <button onclick="closeModal()" class="w-6 h-6 flex items-center justify-center hover:bg-gray-200 rounded">
                            <i class="fas fa-times text-black"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div><span class="font-medium">Mã NV:</span> <span>${employee.id}</span></div>
                            <div><span class="font-medium">Tên nhân viên:</span> <span>${employee.name}</span></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><span class="font-medium">Giới tính:</span> <span>${employee.gender}</span></div>
                            <div><span class="font-medium">Ngày sinh:</span> <span>${new Date(employee.birthDate).toLocaleDateString('vi-VN')}</span></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><span class="font-medium">Số điện thoại:</span> <span>${employee.phone}</span></div>
                            <div><span class="font-medium">Email:</span> <span>${employee.email}</span></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><span class="font-medium">Chức vụ:</span> <span>${employee.role}</span></div>
                            <div><span class="font-medium">Chi nhánh:</span> <span>${employee.branch}</span></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><span class="font-medium">Ca làm việc:</span> <span>${employee.shift}</span></div>
                            <div><span class="font-medium">Trạng thái:</span> <span>${employee.status}</span></div>
                        </div>
                        ${employee.image ? `
                            <div>
                                <span class="font-medium">Ảnh nhân viên:</span>
                                <img src="${employee.image}" alt="Employee" class="w-28 h-36 object-cover rounded-xl mt-2">
                            </div>
                        ` : ''}
                    </div>
                    <div class="flex justify-end mt-6">
                        <button onclick="closeModal()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-black rounded-md shadow-md transition-colors font-semibold">Thoát</button>
                    </div>
                </div>
            </div>
        `
    };

    // Validation functions
    const validateEmployeeId = (value) => {
        if (!value.trim()) return 'Mã nhân viên không được để trống';
        if (!isEditMode && employees.some(e => e.id === value)) return 'Mã nhân viên đã tồn tại';
        return '';
    };
    const validateName = (value) => !value.trim() ? 'Tên nhân viên không được để trống' : '';
    const validatePhone = (value) => {
        if (!value.trim()) return 'Số điện thoại không được để trống';
        return /^[0-9]{10}$/.test(value.replace(/\s/g, '')) ? '' : 'Số điện thoại phải đủ 10 chữ số';
    };
    const validateEmail = (value) => {
        if (!value.trim()) return 'Email không được để trống';
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value) ? '' : 'Email phải có định dạng a@example.com';
    };
    const validatePosition = (value) => !value.trim() ? 'Chức vụ không được để trống' : '';
    const validateBranch = (value) => !value.trim() ? 'Hãy lựa chọn chi nhánh' : '';

    const validateField = (name, value) => {
        switch (name) {
            case 'employeeId': return validateEmployeeId(value);
            case 'name': return validateName(value);
            case 'phone': return validatePhone(value);
            case 'email': return validateEmail(value);
            case 'position': return validatePosition(value);
            case 'branch': return validateBranch(value);
            default: return '';
        }
    };

    const validateAllFields = () => {
        const fields = ['employeeId', 'name', 'phone', 'email', 'position', 'branch'];
        const errors = {};
        fields.forEach(field => {
            const value = document.getElementById(field).value;
            const error = validateField(field, value);
            if (error) errors[field] = error;
            const errorEl = document.getElementById(`${field}Error`);
            if (errorEl) {
                errorEl.textContent = error;
                errorEl.classList.toggle('hidden', !error);
            }
            const inputEl = document.getElementById(field);
            inputEl.classList.toggle('border-red-500', !!error);
            inputEl.classList.toggle('border-neutral-400', !error);
        });
        return Object.keys(errors).length === 0;
    };

    // Modal management
    function openModal(type, data = null) {
        activeModal = type;
        if (type === 'add') {
            isEditMode = false;
            selectedEmployee = null;
            document.getElementById('modalContainer').innerHTML = modalTemplates.add(false);
        } else if (type === 'edit') {
            isEditMode = true;
            selectedEmployee = data;
            document.getElementById('modalContainer').innerHTML = modalTemplates.add(true, data);
        } else if (type === 'search') {
            document.getElementById('modalContainer').innerHTML = modalTemplates.search(data || []);
        } else if (type === 'deleteConfirm') {
            selectedEmployee = data;
            document.getElementById('modalContainer').innerHTML = modalTemplates.deleteConfirm(data.name);
        } else if (type === 'details') {
            document.getElementById('modalContainer').innerHTML = modalTemplates.details(data);
        } else if (type === 'editConfirm') {
            pendingEmployeeData = data;
            document.getElementById('modalContainer').innerHTML = modalTemplates.editConfirm;
        } else {
            document.getElementById('modalContainer').innerHTML = modalTemplates[type];
        }
        // Re-attach image upload event listener
        const imageUpload = document.getElementById('imageUpload');
        if (imageUpload) {
            imageUpload.addEventListener('change', handleImageUpload);
        }
    }

    function closeModal() {
        activeModal = null;
        selectedEmployee = null;
        isEditMode = false;
        pendingEmployeeData = null;
        document.getElementById('modalContainer').innerHTML = '';
        renderEmployees();
    }

    // Render employee table
    function renderEmployees() {
        const tbody = document.getElementById('employeeTableBody');
        tbody.innerHTML = '';
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const paginatedEmployees = employees.slice(start, end);

        if (paginatedEmployees.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-700">Không có dữ liệu</td></tr>';
            return;
        }

        paginatedEmployees.forEach((employee, index) => {
            const row = document.createElement('tr');
            row.className = `h-16 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-gray-100 transition-colors`;
            row.innerHTML = `
                <td class="px-4 py-2 text-sm text-gray-700">${employee.id}</td>
                <td class="px-4 py-2 text-sm text-gray-700 font-medium">${employee.name}</td>
                <td class="px-4 py-2 text-sm text-gray-700">${employee.shift}</td>
                <td class="px-4 py-2 text-sm text-gray-700">${employee.role}</td>
                <td class="px-4 py-2 text-sm text-gray-700">${employee.branch}</td>
                <td class="px-4 py-2 text-sm text-gray-700">
                    <span class="px-2 py-1 rounded-full text-xs font-medium">${employee.status}</span>
                </td>
                <td class="px-4 py-2">
                    <div class="flex space-x-2">
                        <button onclick='openModal("details", ${JSON.stringify(employee)})' class="text-black hover:text-gray-800 p-1 hover:bg-gray-50 rounded transition-colors" title="Xem chi tiết">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick='openModal("edit", ${JSON.stringify(employee)})' class="text-black hover:text-gray-800 p-1 hover:bg-gray-50 rounded transition-colors" title="Chỉnh sửa">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick='openModal("deleteConfirm", ${JSON.stringify(employee)})' class="text-black hover:text-gray-800 p-1 hover:bg-gray-50 rounded transition-colors" title="Xóa">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
        updatePagination();
    }

    // Pagination rendering
    function updatePagination() {
        const totalPages = Math.ceil(employees.length / itemsPerPage);
        document.getElementById('prevPage').disabled = currentPage === 1;
        document.getElementById('nextPage').disabled = currentPage >= totalPages;

        const pageButtons = document.getElementById('pageButtons');
        pageButtons.innerHTML = '';

        for (let i = 1; i <= totalPages; i++) {
            const button = document.createElement('button');
            button.className = `px-3 py-1 rounded transition-colors ${i === currentPage ? 'bg-purple-600 text-white' : 'bg-gray-100 hover:bg-gray-200'}`;
            button.textContent = i;
            button.onclick = () => changePage(i);
            pageButtons.appendChild(button);
        }
    }

    function changePage(page) {
        currentPage = page;
        renderEmployees();
    }

    // Handle image upload
    function handleImageUpload(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                document.getElementById('imagePreview').innerHTML = `<img src="${event.target.result}" alt="Preview" class="w-full h-full object-cover" />`;
            };
            reader.readAsDataURL(file);
        }
    }

    // Save employee
    function handleSave() {
        if (!validateAllFields()) return;

        const employeeData = {
            id: document.getElementById('employeeId').value,
            name: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            email: document.getElementById('email').value,
            role: document.getElementById('position').value,
            branch: document.getElementById('branch').value,
            shift: document.getElementById('shift').value,
            birthDate: document.getElementById('birthDate').value,
            gender: document.querySelector('input[name="gender"]:checked').value,
            image: document.getElementById('imagePreview').querySelector('img')?.src || '',
            status: isEditMode ? (selectedEmployee?.status || 'Đang hoạt động') : 'Đang hoạt động',
            statusType: isEditMode ? (selectedEmployee?.statusType || 'active') : 'active'
        };

        if (isEditMode) {
            openModal('editConfirm', employeeData);
        } else {
            employees.push(employeeData);
            localStorage.setItem('employees', JSON.stringify(employees));
            closeModal();
            openModal('saveSuccess');
        }
    }

    // Confirm edit
    function handleConfirmEdit() {
        if (pendingEmployeeData) {
            employees = employees.map(e => e.id === pendingEmployeeData.id ? pendingEmployeeData : e);
            localStorage.setItem('employees', JSON.stringify(employees));
            pendingEmployeeData = null;
            closeModal();
            openModal('editSuccess');
        }
    }

    // Search employees
    function searchEmployees() {
        const searchTerm = document.getElementById('searchInput').value.trim();
        const results = searchTerm ? employees.filter(e =>
            e.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
            e.id.toLowerCase().includes(searchTerm.toLowerCase())
        ) : [];
        openModal('search', results);
    }

    // Confirm delete
    function handleConfirmDelete() {
        if (selectedEmployee && selectedEmployee.id) {
            employees = employees.filter(e => e.id !== selectedEmployee.id);
            localStorage.setItem('employees', JSON.stringify(employees));
            const totalPages = Math.ceil(employees.length / itemsPerPage);
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
            } else if (totalPages === 0) {
                currentPage = 1;
            }
            closeModal();
            openModal('deleteSuccess');
        }
    }

    // Event listeners
    document.getElementById('addNewBtn').addEventListener('click', () => openModal('add'));
    document.getElementById('searchBtn').addEventListener('click', searchEmployees);
    document.getElementById('searchInput').addEventListener('keypress', (e) => e.key === 'Enter' && searchEmployees());
    document.getElementById('prevPage').addEventListener('click', () => changePage(currentPage - 1));
    document.getElementById('nextPage').addEventListener('click', () => changePage(currentPage + 1));

    // Initialize
    renderEmployees();
</script>
</body>
</html>