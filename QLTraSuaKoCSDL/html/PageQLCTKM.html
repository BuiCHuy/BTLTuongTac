<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FiveH Promotions Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        @keyframes slide-up { from { transform: translateY(20px); opacity: 0.5; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slide-up 0.35s ease-out forwards; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;

    function FormGroup({ label, children, htmlFor }) {
        return (
            <div>
                <label htmlFor={htmlFor} className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
                {children}
            </div>
        );
    }

    function CustomRadio({ name, value, label, checked, onChange }) {
        return (
            <label className="flex items-center space-x-3 cursor-pointer">
                <input type="radio" name={name} value={value} checked={checked} onChange={onChange} className="peer sr-only" />
                <div className="w-5 h-5 rounded-full border-2 border-gray-300 ring-offset-2 peer-checked:bg-purple-600 peer-checked:border-purple-600 peer-focus:ring-2 peer-focus:ring-purple-400 flex items-center justify-center transition">
                    <div className="w-1.5 h-1.5 bg-white rounded-full"></div>
                </div>
                <span className="text-gray-800">{label}</span>
            </label>
        );
    }

    function SuccessModal({ isOpen, onClose }) {
        if (!isOpen) return null;
        return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div className="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center animate-slide-up">
                    <div className="mx-auto mb-4 w-16 h-16 flex items-center justify-center rounded-full border-2 border-gray-500">
                        <i className="fas fa-check fa-2x text-green-600"></i>
                    </div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">Thêm thành công</h2>
                    <p className="text-gray-600 mb-6">Bạn đã thêm thành công chương trình khuyến mại mới.</p>
                    <button onClick={onClose} className="h-11 px-6 bg-gray-100 border border-gray-200 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-200 transition-colors shadow-sm">Thoát</button>
                </div>
            </div>
        );
    }

    function ConfirmDeleteModal({ isOpen, onClose, onConfirm, promotionName }) {
        if (!isOpen) return null;
        return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div className="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center animate-slide-up">
                    <div className="mx-auto mb-4 w-16 h-16 flex items-center justify-center rounded-full border-2 border-yellow-500 bg-yellow-100">
                        <i className="fas fa-exclamation-triangle fa-2x text-yellow-600"></i>
                    </div>
                    <h2 className="text-xl font-bold text-gray-800 mb-2">Bạn có chắc chắn muốn xóa?</h2>
                    <p className="text-gray-600 mb-4">Sau khi xóa, "<span className="font-semibold">{promotionName}</span>" sẽ không thể khôi phục lại.</p>
                    <div className="flex justify-center space-x-4">
                        <button onClick={onConfirm} className="flex-1 h-11 px-6 bg-gray-900 text-white font-semibold rounded-lg shadow-md hover:bg-gray-800 focus:outline-none focus-ring-2 focus-ring-gray-700 transition-colors">Có</button>
                        <button onClick={onClose} className="flex-1 h-11 px-6 bg-white border border-gray-300 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-100 focus:outline-none focus-ring-2 focus-ring-gray-300 transition-colors">Không</button>
                    </div>
                </div>
            </div>
        );
    }

    function DeleteSuccessModal({ isOpen, onClose, promotionName }) {
        if (!isOpen) return null;
        return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div className="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center animate-slide-up">
                    <div className="mx-auto mb-4 w-16 h-16 flex items-center justify-center rounded-full border-2 border-green-500 bg-green-100">
                        <i className="fas fa-check fa-2x text-green-600"></i>
                    </div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">Xóa thành công</h2>
                    <p className="text-gray-600 mb-6">Chương trình khuyến mại đã được xóa bỏ.</p>
                    <button onClick={onClose} className="h-11 px-6 bg-gray-100 border border-gray-200 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-200 transition-colors shadow-sm">Thoát</button>
                </div>
            </div>
        );
    }

    function ConfirmEditModal({ isOpen, onClose, onConfirm }) {
        if (!isOpen) return null;
        return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div className="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center animate-slide-up">
                    <div className="mx-auto mb-4 w-16 h-16 flex items-center justify-center rounded-full border-2 border-blue-500 bg-blue-100">
                        <i className="fas fa-question fa-2x text-blue-600"></i>
                    </div>
                    <h2 className="text-xl font-bold text-gray-800 mb-2">Xác nhận sửa</h2>
                    <p className="text-gray-600 mb-4">Thông tin của chương trình khuyến mại sẽ được cập nhật. Bạn có chắc chắn không?</p>
                    <div className="flex justify-center space-x-4">
                        <button onClick={onConfirm} className="flex-1 h-11 px-6 bg-gray-900 text-white font-semibold rounded-lg shadow-md hover:bg-gray-800 focus:outline-none focus-ring-2 focus-ring-gray-700 transition-colors">Có, Cập nhật</button>
                        <button onClick={onClose} className="flex-1 h-11 px-6 bg-white border border-gray-300 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-100 focus:outline-none focus-ring-2 focus-ring-gray-300 transition-colors">Không</button>
                    </div>
                </div>
            </div>
        );
    }

    function AddPromotionModal({ isOpen, onClose, onSave, existingPromotions, promotionToEdit }) {
        const [formData, setFormData] = useState({});
        const [errors, setErrors] = useState({});
        const [conditions, setConditions] = useState([]);

        const addCondition = () => {
            const newCondition = { id: Date.now(), type: 'Giá trị tối thiểu', value: '' };
            setConditions(prev => [...prev, newCondition]);
        };

        const removeCondition = (id) => {
            setConditions(prev => prev.filter(condition => condition.id !== id));
        };

        const handleConditionChange = (id, field, value) => {
            setConditions(prev => prev.map(c => (c.id === id ? { ...c, [field]: value } : c)));
        };

        useEffect(() => {
            if (isOpen) {
                if (promotionToEdit) {
                    const typeParts = promotionToEdit.type.split('-');
                    const discountParts = promotionToEdit.discount.match(/(\d+)/);
                    setFormData({
                        id: promotionToEdit.id,
                        promoName: promotionToEdit.name,
                        status: promotionToEdit.status === "Kích hoạt" ? 'active' : 'inactive',
                        notes: promotionToEdit.notes || '',
                        promoBy: typeParts[0] ? typeParts[0].trim() : 'Hóa đơn',
                        promoType: typeParts[1] ? typeParts[1].trim() : 'Giảm giá theo %',
                        discountValue: discountParts ? discountParts[0] : '',
                        startDate: promotionToEdit.startDate,
                        endDate: promotionToEdit.endDate,
                        scope: promotionToEdit.scope === 'Toàn bộ chi nhánh' ? 'all' : 'specific',
                        branch: promotionToEdit.scope !== 'Toàn bộ chi nhánh' ? promotionToEdit.scope : 'Chi nhánh A'
                    });
                    setConditions(promotionToEdit.conditions || []);
                } else {
                    setFormData({
                        id: '', promoName: '', status: 'active', notes: '',
                        promoBy: 'Hóa đơn', promoType: 'Giảm giá theo %', discountValue: '',
                        startDate: '2025-06-15', endDate: '2025-07-15',
                        scope: 'all', branch: 'Chi nhánh A'
                    });
                    setConditions([]);
                }
                setErrors({});
            }
        }, [isOpen, promotionToEdit]);

        const handleChange = (e) => {
            const { id, value, name, type } = e.target;
            const key = type === 'radio' ? name : id;
            setFormData(prev => ({ ...prev, [key]: value }));
        };

        const handleSave = () => {
            const validationErrors = {};
            const trimmedId = formData.id ? formData.id.trim() : '';
            if (!formData.id || !formData.id.trim()) {
                validationErrors.id = 'Mã chương trình không được để trống';
            } else if (existingPromotions.some(promo => promo.id === trimmedId && (!promotionToEdit || promo.id !== promotionToEdit.id))) {
                validationErrors.id = 'Mã chương trình này đã tồn tại';
            }
            if (!formData.promoName || !formData.promoName.trim()) {
                validationErrors.promoName = 'Tên chương trình không được để trống';
            }
            if (!formData.discountValue || formData.discountValue.trim() === '' || isNaN(formData.discountValue) || Number(formData.discountValue) <= 0) {
                validationErrors.discountValue = 'Mức giảm không được để trống và phải là số lớn hơn 0';
            }
            const startDate = new Date(formData.startDate);
            const endDate = new Date(formData.endDate);
            if (startDate > endDate) {
                validationErrors.date = 'Ngày kết thúc phải lớn hơn hoặc bằng ngày bắt đầu';
            }

            if (Object.keys(validationErrors).length > 0) {
                setErrors(validationErrors);
                return;
            }

            setErrors({});
            const finalId = formData.id || `CT${Date.now().toString().slice(-4)}`;
            let finalScope = formData.scope === 'all' ? 'Toàn bộ chi nhánh' : formData.branch;
            const promotionData = {
                id: trimmedId,
                name: formData.promoName,
                startDate: formData.startDate,
                endDate: formData.endDate,
                type: `${formData.promoBy}-${formData.promoType}`,
                discount: `${formData.discountValue || 0} ${formData.promoType === 'Giảm giá theo %' ? '%' : 'VND'}`,
                status: formData.status === 'active' ? "Kích hoạt" : "Chưa kích hoạt",
                scope: finalScope,
                notes: formData.notes || 'Không có',
                conditions: conditions
            };
            onSave(promotionData);
        };

        if (!isOpen) return null;
        return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div className="w-full max-w-5xl max-h-[95vh] bg-gray-50 rounded-lg shadow-2xl flex flex-col animate-slide-up">
                    <header className="flex items-center justify-between p-5 border-b border-gray-200 rounded-t-lg">
                        <h2 className="text-xl font-bold text-gray-800">{promotionToEdit ? 'Sửa chương trình khuyến mại' : 'Thêm chương trình khuyến mại'}</h2>
                        <button onClick={onClose} className="w-10 h-10 rounded-full text-gray-500 hover:bg-gray-200 hover:text-gray-800 transition-colors flex items-center justify-center">
                            <i className="fas fa-times fa-lg"></i>
                        </button>
                    </header>
                    <div className="p-8 space-y-8 overflow-y-auto">
                        <fieldset className="space-y-6">
                            <legend className="text-lg font-semibold text-purple-700">Thông tin chung</legend>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <FormGroup label="Mã chương trình" htmlFor="id">
                                    <input type="text" id="id" value={formData.id || ''} onChange={handleChange} placeholder="Nhập mã chương trình" className="w-full h-10 px-4 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500" />
                                    {errors.id && <p className="text-red-600 text-sm mt-1">{errors.id}</p>}
                                </FormGroup>
                                <FormGroup label="Tên chương trình" htmlFor="promoName">
                                    <input type="text" id="promoName" value={formData.promoName || ''} onChange={handleChange} placeholder="VD: Khai trương hồng phát" className="w-full h-10 px-4 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500" />
                                    {errors.promoName && <p className="text-red-600 text-sm mt-1">{errors.promoName}</p>}
                                </FormGroup>
                                <FormGroup label="Trạng thái">
                                    <div className="flex items-center space-x-6 h-10">
                                        <CustomRadio name="status" value="active" label="Kích hoạt" checked={formData.status === 'active'} onChange={handleChange} />
                                        <CustomRadio name="status" value="inactive" label="Chưa kích hoạt" checked={formData.status === 'inactive'} onChange={handleChange} />
                                    </div>
                                </FormGroup>
                                <FormGroup label="Ghi chú" htmlFor="notes">
                                    <input type="text" id="notes" value={formData.notes || ''} onChange={handleChange} placeholder="Thông tin thêm về chương trình" className="w-full h-10 px-4 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500" />
                                </FormGroup>
                            </div>
                        </fieldset>
                        <fieldset className="space-y-6">
                            <legend className="text-lg font-semibold text-purple-700">Hình thức & Mức giảm</legend>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <FormGroup label="Khuyến mại theo" htmlFor="promoBy"><select id="promoBy" value={formData.promoBy || 'Hóa đơn'} onChange={handleChange} className="w-full h-10 px-3 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500"><option>Hóa đơn</option><option>Sản phẩm</option></select></FormGroup>
                                <FormGroup label="Hình thức" htmlFor="promoType"><select id="promoType" value={formData.promoType || 'Giảm giá theo %'} onChange={handleChange} className="w-full h-10 px-3 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500"><option>Giảm giá theo %</option><option>Giảm giá trực tiếp (VND)</option></select></FormGroup>
                                <FormGroup label="Mức giảm" htmlFor="discountValue">
                                    <div className="relative">
                                        <input type="number" id="discountValue" value={formData.discountValue || ''} onChange={handleChange} placeholder="VD: 10" className="w-full h-10 pl-4 pr-10 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500" />
                                        <span className="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">{formData.promoType === 'Giảm giá theo %' ? '%' : 'VND'}</span>
                                    </div>
                                    {errors.discountValue && <p className="text-red-600 text-sm mt-1">{errors.discountValue}</p>}
                                </FormGroup>
                            </div>
                        </fieldset>
                        <fieldset className="space-y-6">
                            <legend className="text-lg font-semibold text-purple-700">Thời gian & Phạm vi</legend>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-6">
                                <div className="space-y-6">
                                    <FormGroup label="Ngày bắt đầu" htmlFor="startDate"><input type="date" id="startDate" value={formData.startDate || ''} onChange={handleChange} className="w-full h-10 px-4 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500" /></FormGroup>
                                    <FormGroup label="Ngày kết thúc" htmlFor="endDate"><input type="date" id="endDate" value={formData.endDate || ''} onChange={handleChange} className="w-full h-10 px-4 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500" /></FormGroup>
                                    {errors.date && <p className="text-red-600 text-sm mt-1">{errors.date}</p>}
                                </div>
                                <div className="space-y-4">
                                    <label className="block text-sm font-medium text-gray-700">Phạm vi áp dụng</label>
                                    <div className="space-y-4">
                                        <CustomRadio name="scope" value="all" label="Toàn bộ chi nhánh" checked={formData.scope === 'all'} onChange={handleChange} />
                                        <div className="flex items-center">
                                            <CustomRadio name="scope" value="specific" label="Chi nhánh cụ thể" checked={formData.scope === 'specific'} onChange={handleChange} />
                                            <select id="branch" value={formData.branch || ''} onChange={handleChange} disabled={formData.scope !== 'specific'} className={`ml-5 flex-grow h-10 px-3 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 transition-colors ${formData.scope !== 'specific' ? 'bg-gray-200 cursor-not-allowed' : ''}`}>
                                                <option>Chi nhánh A</option>
                                                <option>Chi nhánh B</option>
                                                <option>Chi nhánh C</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset>
                            <legend className="text-lg font-semibold text-purple-700">Điều kiện áp dụng</legend>
                            <div className="mt-4 space-y-4">
                                {conditions.map((condition, index) => (
                                    <div key={condition.id} className="flex items-center space-x-4 p-4 bg-purple-50 rounded-lg animate-fade-in">
                                        <span className="font-bold text-gray-600">#{index + 1}</span>
                                        <select value={condition.type} onChange={(e) => handleConditionChange(condition.id, 'type', e.target.value)} className="w-1/3 h-10 px-3 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 transition">
                                            <option value="Giá trị tối thiểu">Giá trị tối thiểu</option>
                                            <option value="Số lượng sản phẩm tối thiểu">Số lượng sản phẩm tối thiểu</option>
                                        </select>
                                        <input type="text" placeholder="Nhập giá trị (VD: 500000 hoặc VIP)" value={condition.value} onChange={(e) => handleConditionChange(condition.id, 'value', e.target.value)} className="flex-grow h-10 px-4 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 transition" />
                                        <button onClick={() => removeCondition(condition.id)} className="w-10 h-10 flex-shrink-0 text-red-500 hover:bg-red-100 rounded-full flex items-center justify-center transition-colors" title="Xóa điều kiện">
                                            <i className="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                ))}
                                <button type="button" onClick={addCondition} className="h-10 px-4 py-2 bg-purple-100 text-purple-700 font-semibold rounded-lg shadow-sm hover:bg-purple-200 transition-colors flex items-center gap-2">
                                    <i className="fas fa-plus"></i>
                                    <span>Thêm điều kiện</span>
                                </button>
                                <p className="text-xs text-gray-500 mt-2">VD: Tổng hóa đơn tối thiểu 500,000 VND.</p>
                            </div>
                        </fieldset>
                    </div>
                    <footer className="flex justify-end items-center p-5 space-x-4 border-t border-gray-200 bg-gray-100 rounded-b-lg mt-auto">
                        <button onClick={onClose} className="h-11 px-6 bg-white border border-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-100 transition-colors shadow-sm">Thoát</button>
                        <button onClick={handleSave} className="h-11 px-8 text-white font-semibold rounded-lg bg-gradient-to-r from-purple-600 to-rose-500 hover:from-purple-700 hover:to-rose-600 shadow-md transition-all transform hover:scale-105 flex items-center gap-2">
                            <i className="fas fa-save"></i><span>Lưu chương trình</span>
                        </button>
                    </footer>
                </div>
            </div>
        );
    }

    function FilterModal({ isOpen, onClose, onFilter }) {
        const [filterData, setFilterData] = useState({
            branch: 'Tất cả',
            status: 'Tất cả',
            validity: 'Tất cả'
        });

        const handleChange = (e) => {
            const { name, value } = e.target;
            setFilterData(prev => ({ ...prev, [name]: value }));
        };

        const handleFilter = () => {
            onFilter(filterData);
            onClose();
        };

        if (!isOpen) return null;

        return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div className="bg-white rounded-lg shadow-xl p-6 w-96 animate-slide-up">
                    <h2 className="text-xl font-bold text-gray-800 mb-6 text-center">Lọc chương trình khuyến mãi</h2>
                    <div className="space-y-6">
                        <FormGroup label="Chi nhánh:" htmlFor="branch">
                            <select id="branch" name="branch" value={filterData.branch} onChange={handleChange} className="w-full h-10 px-3 bg-white rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500">
                                <option>Tất cả</option>
                                <option>Chi nhánh A</option>
                                <option>Chi nhánh B</option>
                                <option>Chi nhánh C</option>
                            </select>
                        </FormGroup>
                        <FormGroup label="Trạng thái:" htmlFor="status">
                            <div className="space-y-2">
                                <CustomRadio name="status" value="Tất cả" label="Tất cả" checked={filterData.status === 'Tất cả'} onChange={handleChange} />
                                <CustomRadio name="status" value="Kích hoạt" label="Kích hoạt" checked={filterData.status === 'Kích hoạt'} onChange={handleChange} />
                                <CustomRadio name="status" value="Chưa kích hoạt" label="Chưa kích hoạt" checked={filterData.status === 'Chưa kích hoạt'} onChange={handleChange} />
                            </div>
                        </FormGroup>
                        <FormGroup label="Hiệu lực:" htmlFor="validity">
                            <div className="space-y-2">
                                <CustomRadio name="validity" value="Tất cả" label="Tất cả" checked={filterData.validity === 'Tất cả'} onChange={handleChange} />
                                <CustomRadio name="validity" value="Còn hiệu lực" label="Còn hiệu lực" checked={filterData.validity === 'Còn hiệu lực'} onChange={handleChange} />
                                <CustomRadio name="validity" value="Hết hiệu lực" label="Hết hiệu lực" checked={filterData.validity === 'Hết hiệu lực'} onChange={handleChange} />
                            </div>
                        </FormGroup>
                    </div>
                    <div className="flex justify-end space-x-4 mt-8">
                        <button onClick={onClose} className="h-11 px-6 bg-white border border-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-100 transition-colors">Thoát</button>
                        <button onClick={handleFilter} className="h-11 px-6 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors">Lọc</button>
                    </div>
                </div>
            </div>
        );
    }

    function Pagination({ recordsPerPage, totalRecords, paginate, nextPage, prevPage, currentPage }) {
        const pageNumbers = [];
        for (let i = 1; i <= Math.ceil(totalRecords / recordsPerPage); i++) {
            pageNumbers.push(i);
        }
        if (pageNumbers.length <= 1) return null;
        return (
            <div className="flex items-center justify-between mt-6">
                <button onClick={prevPage} disabled={currentPage === 1} className="flex items-center space-x-2 px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <i className="fas fa-chevron-left"></i>
                    <span>Previous</span>
                </button>
                <div className="flex space-x-2">
                    {pageNumbers.map(number => (
                        <button key={number} onClick={() => paginate(number)} className={`w-10 h-10 rounded-lg ${currentPage === number ? 'bg-purple-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'} transition-colors`}>{number}</button>
                    ))}
                </div>
                <button onClick={nextPage} disabled={currentPage === pageNumbers.length} className="flex items-center space-x-2 px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <span>Next</span>
                    <i className="fas fa-chevron-right"></i>
                </button>
            </div>
        );
    }

    function DetailsModal({ isOpen, onClose, promotion }) {
        if (!isOpen || !promotion) return null;

        const currentDate = new Date('2025-06-15T19:10:00+07:00');
        const startDate = new Date(promotion.startDate);
        const endDate = new Date(promotion.endDate);
        const isActive = promotion.status === "Kích hoạt";
        const isValid = endDate > currentDate;

        const validity = isActive
            ? (isValid ? "Còn hiệu lực" : "Hết hiệu lực")
            : "Chưa kích hoạt";

        return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl animate-slide-up">
                    <div className="flex justify-between items-center border-b border-gray-200 pb-4 mb-4">
                        <h2 className="text-xl font-bold text-gray-800">Thông tin chương trình khuyến mại</h2>
                        <button onClick={onClose} className="w-10 h-10 rounded-full text-gray-500 hover:bg-gray-200 hover:text-gray-800 transition-colors flex items-center justify-center">
                            <i className="fas fa-times fa-lg"></i>
                        </button>
                    </div>
                    <div className="space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                            <div><span className="font-medium">Mã CT:</span> <span>{promotion.id}</span></div>
                            <div><span className="font-medium">Tên CT:</span> <span>{promotion.name}</span></div>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div><span className="font-medium">Hình thức:</span> <span>{promotion.type}</span></div>
                            <div><span className="font-medium">Trạng thái:</span> <span>{promotion.status}</span></div>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div><span className="font-medium">Hiệu lực:</span> <span>{validity}</span></div>
                            <div><span className="font-medium">Ghi chú:</span> <span>{promotion.notes || 'Không có'}</span></div>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div><span className="font-medium">Chi nhánh áp dụng:</span> <span>{promotion.scope}</span></div>
                            <div><span className="font-medium">Điều kiện áp dụng:</span> <span>{promotion.conditions.length > 0 ? promotion.conditions.map(c => `${c.type}: ${c.value}`).join(', ') : 'Không có'}</span></div>
                        </div>
                    </div>
                    <div className="flex justify-end mt-6">
                        <button onClick={onClose} className="h-10 px-6 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">Thoát</button>
                    </div>
                </div>
            </div>
        );
    }

    function SearchResultsModal({ isOpen, onClose, results, onViewDetails }) {
        if (!isOpen) return null;

        return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in">
                <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl animate-slide-up">
                    <div className="flex justify-between items-center border-b border-gray-200 pb-4 mb-4">
                        <h2 className="text-xl font-bold text-gray-800">Kết quả tìm kiếm</h2>
                        <button onClick={onClose} className="w-10 h-10 rounded-full text-gray-500 hover:bg-gray-200 hover:text-gray-800 transition-colors flex items-center justify-center">
                            <i className="fas fa-times fa-lg"></i>
                        </button>
                    </div>
                    <p className="text-gray-600 mb-4">Nhấn vào để xem thông tin chi tiết</p>
                    <div className="overflow-y-auto max-h-[60vh]">
                        {results.length > 0 ? (
                            <table className="w-full table-fixed">
                                <thead>
                                <tr className="bg-purple-100 text-left">
                                    <th className="w-1/6 px-4 py-2 font-semibold text-gray-800">Mã CT</th>
                                    <th className="w-2/6 px-4 py-2 font-semibold text-gray-800">Tên CT</th>
                                    <th className="w-1/6 px-4 py-2 font-semibold text-gray-800">Ngày bắt đầu</th>
                                    <th className="w-1/6 px-4 py-2 font-semibold text-gray-800">Ngày kết thúc</th>
                                    <th className="w-1/6 px-4 py-2 font-semibold text-gray-800">Hình thức</th>
                                    <th className="w-1/6 px-4 py-2 font-semibold text-gray-800">Mức giảm giá/Quà tặng</th>
                                </tr>
                                </thead>
                                <tbody>
                                {results.map((promotion) => (
                                    <tr
                                        key={promotion.id}
                                        className="hover:bg-gray-100 cursor-pointer"
                                        onClick={() => onViewDetails(promotion)}
                                    >
                                        <td className="px-4 py-2 text-gray-700">{promotion.id}</td>
                                        <td className="px-4 py-2 text-gray-700">{promotion.name}</td>
                                        <td className="px-4 py-2 text-gray-700">{new Date(promotion.startDate).toLocaleDateString('vi-VN')}</td>
                                        <td className="px-4 py-2 text-gray-700">{new Date(promotion.endDate).toLocaleDateString('vi-VN')}</td>
                                        <td className="px-4 py-2 text-gray-700">{promotion.type}</td>
                                        <td className="px-4 py-2 text-gray-700">{promotion.discount}</td>
                                    </tr>
                                ))}
                                </tbody>
                            </table>
                        ) : (
                            <p className="text-center text-gray-500">Không có kết quả nào.</p>
                        )}
                    </div>
                    <div className="flex justify-end mt-6">
                        <button onClick={onClose} className="h-10 px-6 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">Thoát</button>
                    </div>
                </div>
            </div>
        );
    }

    function PromotionsDashboard() {
        const [activeModal, setActiveModal] = useState(null);
        const [promotionToDelete, setPromotionToDelete] = useState(null);
        const [promotionToEdit, setPromotionToEdit] = useState(null);
        const [promotionToView, setPromotionToView] = useState(null);
        const [promotions, setPromotions] = useState([]);
        const [promotionDataToSave, setPromotionDataToSave] = useState(null);
        const [filteredPromotions, setFilteredPromotions] = useState([]);
        const [searchResults, setSearchResults] = useState([]);
        const [searchQuery, setSearchQuery] = useState('');
        const [currentPage, setCurrentPage] = useState(1);
        const [recordsPerPage] = useState(5);

        useEffect(() => {
            const storedPromotions = sessionStorage.getItem('promotions');
            if (storedPromotions) {
                const parsedPromotions = JSON.parse(storedPromotions);
                setPromotions(parsedPromotions);
                setFilteredPromotions(parsedPromotions);
            } else {
                sessionStorage.setItem('promotions', JSON.stringify([]));
                setPromotions([]);
                setFilteredPromotions([]);
            }
        }, []);

        const openAddModal = () => {
            setPromotionToEdit(null);
            setActiveModal('add');
        };

        const closeModal = () => {
            setActiveModal(null);
            setPromotionToEdit(null);
            setPromotionDataToSave(null);
            setPromotionToView(null);
            setSearchResults([]);
            setSearchQuery('');
        };

        const openSuccessModal = () => setActiveModal('success');
        const closeSuccessModal = () => setActiveModal(null);
        const openDeleteConfirmModal = (promotion) => {
            setPromotionToDelete(promotion);
            setActiveModal('deleteConfirm');
        };
        const closeDeleteConfirmModal = () => {
            setPromotionToDelete(null);
            setPromotionToEdit(null);
            setActiveModal(null);
        };
        const openDeleteSuccessModal = () => setActiveModal('deleteSuccess');
        const closeDeleteSuccessModal = () => setActiveModal(null);
        const openEditModal = (promotion) => {
            setPromotionToEdit(promotion);
            setActiveModal('add');
        };
        const openEditConfirmModal = () => setActiveModal('editConfirm');
        const openFilterModal = () => setActiveModal('filter');
        const openDetailsModal = (promotion) => {
            setPromotionToView(promotion);
            setActiveModal('details');
        };

        const handleConfirmEdit = () => {
            if (promotionDataToSave) {
                handleUpdatePromotion(promotionDataToSave);
            }
        };

        const handleAddPromotion = (newPromotion) => {
            try {
                const currentPromotions = JSON.parse(sessionStorage.getItem('promotions')) || [];
                const updatedPromotions = [...currentPromotions, newPromotion];
                sessionStorage.setItem('promotions', JSON.stringify(updatedPromotions));
                setPromotions(updatedPromotions);
                setFilteredPromotions(updatedPromotions);
                closeModal();
                openSuccessModal();
            } catch (error) {
                console.error("Lỗi khi thêm mới:", error);
            }
        };

        const handleUpdatePromotion = (updatedPromotion) => {
            try {
                const currentPromotions = JSON.parse(sessionStorage.getItem('promotions')) || [];
                const updatedPromotions = currentPromotions.map(p =>
                    p.id === (promotionToEdit?.id || updatedPromotion.id) ? updatedPromotion : p
                );
                sessionStorage.setItem('promotions', JSON.stringify(updatedPromotions));
                setPromotions(updatedPromotions);
                setFilteredPromotions(updatedPromotions);
                closeModal();
            } catch (error) {
                console.error("Lỗi khi cập nhật:", error);
            }
        };

        const handleDeletePromotion = (idToDelete) => {
            try {
                const currentPromotions = JSON.parse(sessionStorage.getItem('promotions')) || [];
                const updatedPromotions = currentPromotions.filter(promo => promo.id !== idToDelete);
                sessionStorage.setItem('promotions', JSON.stringify(updatedPromotions));
                setPromotions(updatedPromotions);
                setFilteredPromotions(updatedPromotions);
                closeDeleteConfirmModal();
                openDeleteSuccessModal();
            } catch (error) {
                console.error("Lỗi khi xóa:", error);
            }
        };

        const handleConfirmDelete = () => {
            if (promotionToDelete && promotionToDelete.id) {
                handleDeletePromotion(promotionToDelete.id);
            }
        };

        const handleSave = (promotionData) => {
            if (promotionToEdit) {
                setPromotionDataToSave(promotionData);
                openEditConfirmModal();
            } else {
                handleAddPromotion(promotionData);
            }
        };

        const handleFilter = (filterData) => {
            let filtered = [...promotions];
            if (filterData.branch !== 'Tất cả') {
                filtered = filtered.filter(p => p.scope === filterData.branch || (p.scope === 'Toàn bộ chi nhánh' && filterData.branch === 'Chi nhánh A'));
            }
            if (filterData.status !== 'Tất cả') {
                filtered = filtered.filter(p => p.status === filterData.status);
            }
            if (filterData.validity !== 'Tất cả') {
                const now = new Date('2025-06-15T20:03:00+07:00');
                filtered = filtered.filter(p => {
                    const endDate = new Date(p.endDate);
                    if (filterData.validity === 'Còn hiệu lực') {
                        return endDate > now;
                    } else if (filterData.validity === 'Hết hiệu lực') {
                        return endDate <= now;
                    }
                    return true;
                });
            }
            setFilteredPromotions(filtered);
            setCurrentPage(1);
        };

        const handleSearch = () => {
            if (!searchQuery.trim()) {
                setSearchResults([]);
                setActiveModal('search');
                return;
            }
            if (searchQuery.trim().length < 2) {
                setSearchResults([]);
                setActiveModal('search');
                return;
            }
            const results = promotions.filter(promo =>
                promo.id.toLowerCase().includes(searchQuery.toLowerCase()) ||
                promo.name.toLowerCase().includes(searchQuery.toLowerCase())
            );
            setSearchResults(results);
            setActiveModal('search');
        };

        const indexOfLastRecord = currentPage * recordsPerPage;
        const indexOfFirstRecord = indexOfLastRecord - recordsPerPage;
        const currentRecords = filteredPromotions.slice(indexOfFirstRecord, indexOfLastRecord);

        const paginate = (pageNumber) => setCurrentPage(pageNumber);
        const nextPage = () => {
            if (currentPage < Math.ceil(filteredPromotions.length / recordsPerPage)) {
                setCurrentPage(currentPage + 1);
            }
        };
        const prevPage = () => {
            if (currentPage > 1) {
                setCurrentPage(currentPage - 1);
            }
        };

        return (
            <div className="w-full min-h-screen bg-gray-100 font-sans">
                <header className="flex items-center justify-between px-6 py-4 bg-white shadow-sm">
                    <h1 className="text-3xl font-bold text-indigo-600">FiveH</h1>
                    <div className="flex items-center space-x-6">
                        <div className="flex items-center space-x-2 cursor-pointer hover:text-indigo-600 transition-colors">
                            <i className="fas fa-cog text-gray-600 text-lg"></i>
                            <span className="text-gray-700 font-medium">Cài đặt</span>
                        </div>
                        <div className="flex items-center space-x-3">
                            <img
                                src="https://placehold.co/40x40"
                                alt="Profile"
                                className="w-10 h-10 rounded-full border border-gray-300"
                            />
                            <div className="flex flex-col">
                                <span className="text-gray-700 font-medium">Quản lý</span>
                                <span className="text-gray-500 text-sm cursor-pointer hover:text-indigo-600">
                                    Đăng xuất
                                </span>
                            </div>
                        </div>
                    </div>
                </header>
                <nav className="bg-gradient-to-r from-purple-600 to-rose-500 py-4 px-6 shadow-md">
                    <div className="max-w-7xl mx-auto flex justify-between items-center text-white">{[{ icon: "fa-home", label: "Trang chủ", href: "TrangChu.html", active: true },{ icon: "fa-shopping-cart", label: "Bán hàng", href: "PageBanHang.html" },{ icon: "fa-users", label: "Nhân viên", href: "Staff.html" },{ icon: "fa-box", label: "Mặt hàng", href: "Products.html" },{ icon: "fa-tags", label: "CT Khuyến mại", href: "PageQLCTKM.html" },{ icon: "fa-chart-line", label: "Doanh thu", href: "Revenue.html" }].map((item, index) => (<a key={index} href={item.href} className={`flex items-center space-x-2 cursor-pointer hover:text-gray-200 transition-colors ${item.active ? "text-pink-100" : ""}`}><i className={`fas ${item.icon} text-lg`}></i><span className="text-lg font-semibold">{item.label}</span></a>))}</div>
                </nav>
                <main className="max-w-7xl mx-auto mt-8 px-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">QUẢN LÝ CHƯƠNG TRÌNH KHUYẾN MẠI</h2>
                    <div className="flex items-center justify-between mb-6">
                        <div className="flex items-center space-x-4">
                            <div className="relative">
                                <input
                                    type="text"
                                    placeholder="Tìm kiếm theo tên, theo mã"
                                    className="w-96 px-4 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-600"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                                <i className="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                            <button
                                onClick={handleSearch}
                                className="bg-purple-600 text-white px-4 py-2 rounded-md shadow-lg hover:bg-purple-700 hover:shadow-xl transform hover:-translate-y-px transition-all flex items-center space-x-2"
                            >
                                <i className="fas fa-search"></i>
                            </button>
                        </div>
                        <div className="flex space-x-4">
                            <button
                                onClick={openFilterModal}
                                className="bg-purple-600 text-white px-4 py-2 rounded-md shadow-lg hover:bg-purple-700 hover:shadow-xl transform hover:-translate-y-px transition-all flex items-center space-x-2"
                            >
                                <i className="fas fa-filter"></i><span>Lọc</span>
                            </button>
                            <button
                                onClick={openAddModal}
                                className="bg-purple-600 text-white px-4 py-2 rounded-md shadow-lg hover:bg-purple-700 hover:shadow-xl transform hover:-translate-y-px transition-all flex items-center space-x-2"
                            >
                                <i className="fas fa-plus"></i><span>Thêm mới</span>
                            </button>
                        </div>
                    </div>
                    <div className="bg-white rounded-lg shadow-md border border-violet-200">
                        <table className="w-full table-fixed">
                            <thead><tr className="bg-violet-200 h-16"><th className="w-1/12 px-4 py-2 text-left text-xl font-semibold text-gray-800">Mã CT</th><th className="w-2/12 px-4 py-2 text-left text-xl font-semibold text-gray-800">Tên CT</th><th className="w-2/12 px-4 py-2 text-left text-xl font-semibold text-gray-800">Ngày bắt đầu</th><th className="w-2/12 px-4 py-2 text-left text-xl font-semibold text-gray-800">Ngày kết thúc</th><th className="w-3/12 px-4 py-2 text-left text-xl font-semibold text-gray-800">Hình thức</th><th className="w-2/12 px-4 py-2 text-left text-xl font-semibold text-gray-800">Mức giảm giá/Quà tặng</th><th className="w-2/12 px-4 py-2 text-left text-xl font-semibold text-gray-800">Trạng thái</th><th className="w-2/12 px-4 py-2 text-left text-xl font-semibold text-gray-800">Hành động</th></tr></thead>
                            <tbody>
                            {currentRecords.map((promotion, index) => (
                                <tr key={promotion.id} className={`h-20 ${index % 2 === 0 ? "bg-white" : "bg-violet-50"} hover:bg-violet-100 transition-colors align-middle1`}>
                                    <td className="px-4 py-2 text-base text-gray-700">{promotion.id}</td>
                                    <td className="px-4 py-2 text-base text-gray-700">{promotion.name}</td>
                                    <td className="px-4 py-2 text-base text-gray-700">{new Date(promotion.startDate).toLocaleDateString('vi-VN')}</td>
                                    <td className="px-4 py-2 text-base text-gray-700">{new Date(promotion.endDate).toLocaleDateString('vi-VN')}</td>
                                    <td className="px-4 py-2 text-base text-gray-700">{promotion.type}</td>
                                    <td className="px-4 py-2 text-base text-gray-700">{promotion.discount}</td>
                                    <td className="px-4 py-2 text-base text-gray-700">{promotion.status}</td>
                                    <td className="px-4 py-2">
                                        <div className="flex space-x-4">
                                            <button onClick={() => openDetailsModal(promotion)} className="text-gray-600 hover:text-gray-800">
                                                <i className="fas fa-eye"></i>
                                            </button>
                                            <button onClick={() => openEditModal(promotion)} className="text-gray-600 hover:text-gray-800">
                                                <i className="fas fa-edit"></i>
                                            </button>
                                            <button onClick={() => openDeleteConfirmModal(promotion)} className="text-gray-600 hover:text-red-500">
                                                <i className="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                            </tbody>
                        </table>
                    </div>
                    <Pagination
                        recordsPerPage={recordsPerPage}
                        totalRecords={filteredPromotions.length}
                        paginate={paginate}
                        nextPage={nextPage}
                        prevPage={prevPage}
                        currentPage={currentPage}
                    />
                </main>
                <AddPromotionModal
                    isOpen={activeModal === 'add'}
                    onClose={closeModal}
                    onSave={handleSave}
                    existingPromotions={promotions}
                    promotionToEdit={promotionToEdit}
                />
                <SuccessModal
                    isOpen={activeModal === 'success'}
                    onClose={closeSuccessModal}
                />
                <ConfirmDeleteModal
                    isOpen={activeModal === 'deleteConfirm'}
                    onClose={closeDeleteConfirmModal}
                    onConfirm={handleConfirmDelete}
                    promotionName={promotionToDelete ? promotionToDelete.name : ''}
                />
                <DeleteSuccessModal
                    isOpen={activeModal === 'deleteSuccess'}
                    onClose={closeDeleteSuccessModal}
                    promotionName={promotionToDelete ? promotionToDelete.name : ''}
                />
                <ConfirmEditModal
                    isOpen={activeModal === 'editConfirm'}
                    onClose={closeModal}
                    onConfirm={handleConfirmEdit}
                />
                <FilterModal
                    isOpen={activeModal === 'filter'}
                    onClose={closeModal}
                    onFilter={handleFilter}
                />
                <DetailsModal
                    isOpen={activeModal === 'details'}
                    onClose={closeModal}
                    promotion={promotionToView}
                />
                <SearchResultsModal
                    isOpen={activeModal === 'search'}
                    onClose={closeModal}
                    results={searchResults}
                    onViewDetails={openDetailsModal}
                />
                <style>{/* Nội dung style của bạn được giữ nguyên */}</style>
            </div>
        );
    }

    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<PromotionsDashboard />);
</script>
</body>
</html>